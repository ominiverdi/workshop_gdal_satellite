<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="description" content="Conceptos básicos de GDAL/OGR para el procesamiento de imágenes satelitales " />
    <meta property="og:title" content="RIE tool" />
    <meta property="og:url" content="https://aiguamolls.lorenzobecchi.com/" />
    <meta property="og:description"
        content="Conceptos básicos de GDAL/OGR para el procesamiento de imágenes satelitales " />
    <meta property="og:image" content="https://aiguamolls.lorenzobecchi.com/img/ominoverde.png" />
    <meta property="og:type" content="website" />
    <title>Conceptos básicos de GDAL/OGR para el procesamiento de imágenes satelitales </title>
    <link rel="stylesheet" href="libs/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/index.css" type="text/css">
    <script src="libs/jquery/jquery.min.js"></script>
    <script async src="libs/bootstrap/js/bootstrap.min.js"></script>
    <!-- <script src="libs/leaflet/leaflet.js"></script> -->
    <script async src="js/index.js"></script>
    <!-- <script async src="libs/leaflet/leaflet-pattern.js"></script>
<script async src="libs/leaflet/leaflet.textpath.js"></script> -->
</head>

<body>
    <header class="w-100 p-2 mb-0  text-white bg-dark">
        <div class="row">
            <div class="col  align-self-center page-title">
                <a href="index.html" class=" text-white ">Conceptos básicos de GDAL/OGR para el procesamiento de
                    imágenes satelitales </a>
            </div>
        </div>
    </header>
    <div class=" indexheader"></div>
    <main class="bg-white">
        <div class="slider">
            <div class="slide slide4_1">
                <h1>OGR</h1>
                <p>
                    Vector: GeoPackage, ESRI Shapefile, GML, GeoJSON, AutoCAD DWG, MapInfo (tab and mid/mif), ESRI Coverages, ESRI Personal Geodatabase, DGN, PostGIS, Oracle Spatial, y más …


                </p>

            </div>
            <div class="slide slide4_2">
                <h1>GDAL polygonize</h1>

<pre><p><code>
filename=S2A_MSIL2A_20240605T104031_N0510_R008_T31TEG_20240605T182755.SAFE.zip
geojson_file=enpe.geojson
unzip -l $filename
scl_path=$(unzip -l $filename | grep "_SCL_60m.jp2" | awk '{print $4}')
gdal_polygonize.py /vsizip/$filename/$scl_path -f "GeoJSON" scl_polygons.geojson
</code></p></pre>
            </div>
            <div class="slide slide4_3">
                <h1>ogrinfo</h1>

<pre><p><code>
ogrinfo scl_polygons.geojson -al -so
    </code></p></pre>
            </div>

            
            <div class="slide slide4_4">
                <h1>Extraer la vegetación</h1>
                <pre><p><code>
ogr2ogr -f "GeoJSON" scl_class_4.geojson scl_polygons.geojson -where "DN=4"
                        </code></p></pre>
            </div>

            <!-- <div class="slide slide4_5">
                <h1>Generar el NDVI de la zona vegetada</h1>
                <pre><p><code>
#!/bin/bash

filename=S2A_MSIL2A_20240605T104031_N0510_R008_T31TEG_20240605T182755.SAFE.zip

geojson_file=enpe.geojson

band08_path=$(unzip -l $filename | grep "_B08_10m.jp2$" | awk '{print $4}')
band04_path=$(unzip -l $filename | grep "_B04_10m.jp2$" | awk '{print $4}')
scl_path=$(unzip -l $filename | grep "_SCL_20m.jp2$" | awk '{print $4}')


gdalwarp -overwrite -cutline $geojson_file -crop_to_cutline -dstalpha /vsizip/$filename/$band08_path band08_clipped.tif
gdalwarp -overwrite -cutline $geojson_file -crop_to_cutline -dstalpha /vsizip/$filename/$band04_path band04_clipped.tif

gdal_calc.py -A band08_clipped.tif -B band04_clipped.tif --outfile=ndvi.tif --calc="((A.astype(float) - B.astype(float)) / (A.astype(float) + B.astype(float)))" --type=Float32

gdal_polygonize.py /vsizip/$filename/$scl_path -f "GeoJSON" scl_polygons.geojson

ogr2ogr -f "GeoJSON" scl_vegetation.geojson scl_polygons.geojson -where "DN=4"

ogr2ogr -f GeoJSON -dialect sqlite -sql "SELECT ST_MakeValid(geometry) AS geometry FROM out" scl_vegetation_fix.geojson scl_vegetation.geojson

gdalwarp -overwrite -cutline scl_vegetation_fix.geojson -crop_to_cutline -dstalpha ndvi.tif ndvi_vegetation.tif

gdalinfo -stats ndvi_vegetation.tif

 
                    
                                            </code></p></pre>
            </div>
            <div class="slide slide4_6">
                <h1>NDVI + clip</h1>
                <p>Generación del NDVI en QGIS y recorte a la extensión del parque.</p>
            </div>

            <div class="slide slide2">
                <h1>GDAL</h1>
                <p>Biblioteca de software para la lectura y escritura de formatos de datos geoespaciales.</p>
            </div>

            <div class="slide slide2_1">
                <h1>GDALinfo</h1>
                <p>Proporciona información sobre un conjunto de datos raster.</p>
            </div>

            <div class="slide slide2_2">
                <h1>GDALinfo JSON</h1>
                <p><code>gdalinfo $filename -json</code></p>
            </div>

            <div class="slide slide2_3">
                <h1>GDALinfo screening</h1>
                <p><code>gdalinfo $filename -json | jq '.metadata."".CLOUD_COVERAGE_ASSESSMENT'</code></p>
            </div>

            <div class="slide slide2_4">
                <h1>GDALinfo - machine testing</h1>
<pre><p><code>
cloud_coverage=$(gdalinfo $filename -json | jq -r '.metadata[""].CLOUD_COVERAGE_ASSESSMENT')

if (( $(echo "$cloud_coverage > 1" | bc -l) )); then
echo    
echo "too cloudy"
fi</code></p></pre>
            </div>

            <div class="slide slide2_5">
                <h1>GDAL scripting to NDVI</h1>
<pre><p><code>
#!/bin/bash
filename=S2A_MSIL2A_20240605T104031_N0510_R008_T31TEG_20240605T182755.SAFE.zip
geojson_file=enpe.geojson
band08_path=$(unzip -l $filename | grep "_B08_10m.jp2" | awk '{print $4}')
band04_path=$(unzip -l $filename | grep "_B04_10m.jp2" | awk '{print $4}')

gdalwarp -cutline $geojson_file -crop_to_cutline -dstalpha /vsizip/$filename/$band08_path band08_clipped.tif
gdalwarp -cutline $geojson_file -crop_to_cutline -dstalpha /vsizip/$filename/$band04_path band04_clipped.tif

gdal_calc.py -A band08_clipped.tif -B band04_clipped.tif --outfile=ndvi.tif --calc="(A.astype(float) - B.astype(float)) / (A.astype(float) + B.astype(float))" --type=Float32

rm band08_clipped.tif band04_clipped.tif
</code></p></pre>
    </div>

    <div class="slide slide2_6">
        <h1>GDAL script time</h1>
<pre><p><code>

    real	0m2.055s
    user	0m4.815s
    sys		0m0.319s
    
</code></p></pre>
</div>
<div class="slide slide3">
    <video width="100%" height="100%" controls>
        <source src="video/RestoreMetrics.mp4" type="video/mp4">
        <source src="RestoreMetrics.mp4" type="video/ogg">
      Your browser does not support the video tag.
      </video>
</div>

<div class="slide slide3_1">
    <h1>Logica del report automatico</h1>
    <pre> <p><code>
* Preguntar a Copernicus si hay archivos en el intervalo de fechas.
* Descargar el SCL para cada día disponible.
* Medir si hay suficientes datos válidos para cada día.
* Calcular el NDVI máximo de cada día.
* Escoger el día con el máximo NDVI para el mes inicial y final.
* Bajar los archivos en alta resolución para todas las bandas necesarias para nuestros índices.
* Juntar las piezas en caso de que haya más de un granule involucrado.
* Calcular NDVI, NDMI, BSI para la zona requerida.
* Generar los tiles para la interfaz web y publicarlos en la nube.
* Crear un zip con todos los archivos generados y poblicarlo en la nube.
    </code></p></pre>
</div> -->

<div class="slide slide3_2">
    <h1>Gracias!</h1>
      <p>email:  info@lorenzobecchi.com<br>
    web:  <a href="https://lorenzobecchi.com">lorenzobecchi.com</a></p> 
</div>

            <!-- <div class="slide slide1_5">
                <iframe width="100%" height="100%" src="https://www.youtube.com/embed/yV_ZT-nZ4Yc">
                </iframe>
            </div> -->
            <!-- <div class="slide slide2_4 slide_x">
                <div class="itinerarios"><strong>Itinerarios</strong><br>
                    <p><span class="itinerario itinerario1"><button i="1">Itinerario 1</button></span>
                        <img src="img/access_1.jpg"> <small> Desde el Cortalet hasta el mas del Matà</small>
                    </p>
                    <p><span class="itinerario itinerario2"><button i="2">Itinerario 2</button></span>
                        <img src="img/access_2.jpg"> <small> Del mas del Matá a las lagunas
                            costeras o llaunes</small>
                    </p>
                    <p><span class="itinerario itinerario3"><button i="3">Itinerario 3</button></span> <img
                            src="img/access_3.jpg"> <small> Ruta alrededor de la Reserva
                            Integral de las
                            lagunas costeras</small>
                    </p>
                    <p> <span class="itinerario itinerario4"><button i="4">Itinerario 4</button></span> <img
                            src="img/access_4.jpg"> <small> Desde el Cortalet a los
                            estanques Europa</small>
                    </p>
                    <p> <span class="itinerario itinerario5"><button i="5">Itinerario 5</button></span> <img
                            src="img/access_5.jpg"> <small> Entre dos Ríos</small></p>
                </div>
                <div id="map1" class="mapview"></div>
            </div> -->
        </div>
    </main>
</body>

</html>